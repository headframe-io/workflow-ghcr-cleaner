name: 'GHCR Cleaner'
author: 'William Forde'
description: 'Delete containers on GitHub Container Registry without tags'
branding:
  icon: 'trash-2'
  color: 'blue'
inputs:
  token:
    description: >
      Personal access token (PAT) with `delete:packages` permissions.
    required: true
  repository-owner:
    description: 'The repository owner name.'
    default: ${{ github.repository_owner }}
    required: false
  repository-name:
    description: 'Delete only from repository name.'
    default: ''
    required: false
  package-name:
    description: 'Delete only from package name.'
    required: false
    default: ''
  owner-type:
    description: 'Owner type (org or user).'
    required: true
    options:
      - org
      - user
  delete-untagged:
    description: 'Delete package versions that have no tags and are not a dependency of other tags.'
    required: false
    default: true
  keep-at-most:
    description: 'Keep at most the given amount of image versions. Only applies to tagged image versions.'
    required: false
    default: 0
  filter-tags:
    description: 'List of tags to filter for when using --keep-at-most. Accepts tags as Unix shell-style wildcards.'
    required: false
    default: ''
  skip-tags:
    description: 'List of tags to ignore when using --keep-at-most. Accepts tags as Unix shell-style wildcards.'
    required: false
    default: ''
  dry-run:
    description: 'Run the script without making any changes.'
    required: false
    default: false

runs:
  using: 'docker'
  image: 'docker://ghcr.io/headframe-io/workflow-ghcr-cleaner:latest'
  env:
    TOKEN: ${{ inputs.token }}
    DRY_RUN: ${{ inputs.dry-run }}
    REPOSITORY_OWNER: ${{ inputs.repository-owner }}
    REPOSITORY_NAME: ${{ inputs.repository-name }}
    PACKAGE_NAME: ${{ inputs.package-name }}
    OWNER_TYPE: ${{ inputs.owner-type }}
    DELETE_UNTAGGED: ${{ inputs.delete-untagged }}
    KEEP_AT_MOST: ${{ inputs.keep-at-most }}
    FILTER_TAGS: ${{ inputs.filter-tags }}
    SKIP_TAGS: ${{ inputs.skip-tags }}
